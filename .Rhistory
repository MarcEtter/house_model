mutate(r_d_victory_margin = case_when(
year == 2018 ~ r_d_victory_margin_mit,
.default = r_d_victory_margin
)) |>
mutate(r_d_victory_margin_ensemble =
as.double(r_d_victory_margin_mrp)*ENSEMBLE_WT_MRP +
as.double(r_d_victory_margin_baseline)*ENSEMBLE_WT_BASELINE) |>
select(state, district, year,
r_d_victory_margin,
r_d_victory_margin_baseline,
r_d_victory_margin_mrp,
r_d_victory_margin_ensemble,
matches('[0-9]+')
) |>
filter(year == 2018)
################################################################################
#Visualizations of model performance
#facet wrap?
ggplot(combined, aes(x = r_d_victory_margin_ensemble, y = r_d_victory_margin)) +
geom_point() +
labs(x = '', y = '', title = '') +
theme_bw()
cor_mrp <- cor(combined$r_d_victory_margin, combined$r_d_victory_margin_mrp, use = 'complete.obs')
cor_baseline <- cor(combined$r_d_victory_margin, combined$r_d_victory_margin_baseline, use = 'complete.obs')
cor_ensemble <- cor(combined$r_d_victory_margin, combined$r_d_victory_margin_ensemble, use = 'complete.obs')
cat(paste0('Corr of mrp model predictions and vote share: ', format(cor_mrp, digits = 4)))
cat(paste0('Corr of baseline model predictions and vote share: ', format(cor_baseline, digits = 4)))
cat(paste0('Corr of ensemble model predictions and vote share: ', format(cor_ensemble, digits = 4)))
miss_mrp <- sum(ifelse( (combined$r_d_victory_margin > 0 & combined$r_d_victory_margin_mrp <= 0) |
(combined$r_d_victory_margin <= 0 & combined$r_d_victory_margin_mrp > 0),
1, 0 ), na.rm = T)
miss_baseline <- sum(ifelse( (combined$r_d_victory_margin > 0 & combined$r_d_victory_margin_baseline <= 0) |
(combined$r_d_victory_margin <= 0 & combined$r_d_victory_margin_baseline > 0),
1, 0), na.rm = T)
miss_ensemble <- sum(ifelse( (combined$r_d_victory_margin > 0 & combined$r_d_victory_margin_ensemble <= 0) |
(combined$r_d_victory_margin <= 0 & combined$r_d_victory_margin_ensemble > 0),
1, 0), na.rm = T)
cat(paste0('Mrp model predictions missed races: ', format(miss_mrp, digits = 4)))
cat(paste0('Baseline model predictions missed races: ', format(miss_baseline, digits = 4)))
cat(paste0('Ensemble model predictions missed races: ', format(miss_ensemble, digits = 4)))
diff_mrp <- sum(ifelse( (combined$r_d_victory_margin_mrp >= 0), 1, 0 ), na.rm = T)
diff_baseline <- sum(ifelse( (combined$r_d_victory_margin_baseline >= 0), 1, 0 ), na.rm = T)
diff_ensemble <- sum(ifelse( (combined$r_d_victory_margin_ensemble >= 0), 1, 0 ), na.rm = T)
cat(paste0('Mrp model predicted GOP seats: ', format(diff_mrp, digits = 4)))
cat(paste0('Baseline model predicted GOP seats: ', format(diff_baseline, digits = 4)))
cat(paste0('Ensemble model predicted GOP seats: ', format(diff_ensemble, digits = 4)))
rmse_mrp <- mean((combined$r_d_victory_margin - combined$r_d_victory_margin_mrp)^2, na.rm = T)^0.5
rmse_baseline <- mean((combined$r_d_victory_margin - combined$r_d_victory_margin_baseline)^2, na.rm = T)^0.5
rmse_ensemble <- mean((combined$r_d_victory_margin - combined$r_d_victory_margin_ensemble)^2, na.rm = T)^0.5
cat(paste0('Mrp model predictions RMSE: ', format(rmse_mrp, digits = 4)))
cat(paste0('Baseline model predictions RMSE: ', format(rmse_baseline, digits = 4)))
cat(paste0('Ensemble model predictions RMSE: ', format(rmse_ensemble, digits = 4)))
results_tbl <- data.frame(model = c('MRP','Baseline','Ensemble'),
R = c(cor_mrp, cor_baseline, cor_ensemble),
Missed_Races = c(miss_mrp, miss_baseline, miss_ensemble),
Predicted_GOP_Seats = c(diff_mrp, diff_baseline, diff_ensemble),
RMSE = c(rmse_mrp, rmse_baseline, rmse_ensemble)
) |> t()
# latex_tbl <- xtable(
#   results_tbl,
#   caption = "Model Performance on 2018 U.S. House Elections",
#   label = "tab:model_performance_2018",
#   align = c("l", "l", "c", "c", "c")
# )
#
# print(
#   latex_tbl,
#   file = "tables/model_performance_2018.tex",
#   include.rownames = FALSE,
#   caption.placement = "top"
# )
################################################################################
#Create posterior distribution plot of ensemble and mrp models
posterior_ensemble <- combined |>
select(state, district, year, r_d_victory_margin_baseline, matches('X', ignore.case = F)) |>
mutate(across(matches('X', ignore.case = F),
~ . * ENSEMBLE_WT_MRP + r_d_victory_margin_baseline * ENSEMBLE_WT_BASELINE))
data.frame(seat_count = apply(posterior_ensemble |> select(matches('X', ignore.case = F)),
MARGIN = 2, function(x) {sum(ifelse(x > 0, 1, 0))}) |>
as.vector()) |>
ggplot(aes(seat_count)) +
geom_histogram(binwidth = 1) +
labs(x = '', y = '', title = '')
theme_bw()
library(tidyverse)
library(ggplot2)
library(stringr)
library(xtable)
setwd('~/DropBox/house_model/')
ENSEMBLE_WT_MRP <- 0.5
ENSEMBLE_WT_BASELINE <- 0.5
#Read MIT Data Lab congressional election returns for 2018 to assess models
house <- read.csv('cleaned_data/1976-2024-house.tab') |>
select(-state) |>
rename('state' = 'state_po') |>
#filter(year == 2018) |>
mutate(district = as.integer(district)) |>
filter(party == 'DEMOCRAT' | party == 'REPUBLICAN') |>
mutate(rvote = case_when(
party == 'REPUBLICAN' ~ candidatevotes,
.default = 0
),
dvote = case_when(
party == 'DEMOCRAT' ~ candidatevotes,
.default = 0
)) |>
group_by(district, state, year) |>
summarize(dvoteshr = sum(dvote)/sum(dvote + rvote),
rvoteshr = sum(rvote)/sum(dvote + rvote)) |>
mutate(
r_d_victory_margin_mit = rvoteshr - dvoteshr
)
baseline_pred <- read.csv('cleaned_data/baseline_mod_predictions.csv') |>
mutate(r_d_victory_margin_baseline = r_d_victory_margin_pred/100)
#Check that mit victory margins agree with DDHQ's
x <- left_join(baseline_pred, house, by = c('state','year', 'district')) |>
select(r_d_victory_margin, r_d_victory_margin_mit, state, year, district)
plot(x$r_d_victory_margin, x$r_d_victory_margin_mit)
mrp <- read.csv('cleaned_data/mrp_margin_turnout_weight.csv') |>
mutate(r_d_victory_margin_mrp = mean) |>
mutate(district = case_when(
state %in% c('AK', 'DE', 'MT', 'ND', 'SD', 'VT', 'WY') ~ 0,
.default = district
))
combined <- baseline_pred |>
mutate(r_d_victory_margin = case_when(
year == 2018 ~ NA,
.default = r_d_victory_margin
)) |>
left_join(mrp |> select(state, district, year, r_d_victory_margin_mrp, matches('[^q][0-9]+')),
by = c('state', 'district', 'year')) |>
left_join(house |> select(state, district, year, r_d_victory_margin_mit),
by = c('state', 'district', 'year')) |>
mutate(r_d_victory_margin = case_when(
year == 2018 ~ r_d_victory_margin_mit,
.default = r_d_victory_margin
)) |>
mutate(r_d_victory_margin_ensemble =
as.double(r_d_victory_margin_mrp)*ENSEMBLE_WT_MRP +
as.double(r_d_victory_margin_baseline)*ENSEMBLE_WT_BASELINE) |>
select(state, district, year,
r_d_victory_margin,
r_d_victory_margin_baseline,
r_d_victory_margin_mrp,
r_d_victory_margin_ensemble,
matches('[0-9]+')
) |>
filter(year == 2018)
################################################################################
#Visualizations of model performance
#facet wrap?
ggplot(combined, aes(x = r_d_victory_margin_ensemble, y = r_d_victory_margin)) +
geom_point() +
labs(x = '', y = '', title = '') +
theme_bw()
cor_mrp <- cor(combined$r_d_victory_margin, combined$r_d_victory_margin_mrp, use = 'complete.obs')
cor_baseline <- cor(combined$r_d_victory_margin, combined$r_d_victory_margin_baseline, use = 'complete.obs')
cor_ensemble <- cor(combined$r_d_victory_margin, combined$r_d_victory_margin_ensemble, use = 'complete.obs')
cat(paste0('Corr of mrp model predictions and vote share: ', format(cor_mrp, digits = 4)))
cat(paste0('Corr of baseline model predictions and vote share: ', format(cor_baseline, digits = 4)))
cat(paste0('Corr of ensemble model predictions and vote share: ', format(cor_ensemble, digits = 4)))
miss_mrp <- sum(ifelse( (combined$r_d_victory_margin > 0 & combined$r_d_victory_margin_mrp <= 0) |
(combined$r_d_victory_margin <= 0 & combined$r_d_victory_margin_mrp > 0),
1, 0 ), na.rm = T)
miss_baseline <- sum(ifelse( (combined$r_d_victory_margin > 0 & combined$r_d_victory_margin_baseline <= 0) |
(combined$r_d_victory_margin <= 0 & combined$r_d_victory_margin_baseline > 0),
1, 0), na.rm = T)
miss_ensemble <- sum(ifelse( (combined$r_d_victory_margin > 0 & combined$r_d_victory_margin_ensemble <= 0) |
(combined$r_d_victory_margin <= 0 & combined$r_d_victory_margin_ensemble > 0),
1, 0), na.rm = T)
cat(paste0('Mrp model predictions missed races: ', format(miss_mrp, digits = 4)))
cat(paste0('Baseline model predictions missed races: ', format(miss_baseline, digits = 4)))
cat(paste0('Ensemble model predictions missed races: ', format(miss_ensemble, digits = 4)))
diff_mrp <- sum(ifelse( (combined$r_d_victory_margin_mrp >= 0), 1, 0 ), na.rm = T)
diff_baseline <- sum(ifelse( (combined$r_d_victory_margin_baseline >= 0), 1, 0 ), na.rm = T)
diff_ensemble <- sum(ifelse( (combined$r_d_victory_margin_ensemble >= 0), 1, 0 ), na.rm = T)
cat(paste0('Mrp model predicted GOP seats: ', format(diff_mrp, digits = 4)))
cat(paste0('Baseline model predicted GOP seats: ', format(diff_baseline, digits = 4)))
cat(paste0('Ensemble model predicted GOP seats: ', format(diff_ensemble, digits = 4)))
rmse_mrp <- mean((combined$r_d_victory_margin - combined$r_d_victory_margin_mrp)^2, na.rm = T)^0.5
rmse_baseline <- mean((combined$r_d_victory_margin - combined$r_d_victory_margin_baseline)^2, na.rm = T)^0.5
rmse_ensemble <- mean((combined$r_d_victory_margin - combined$r_d_victory_margin_ensemble)^2, na.rm = T)^0.5
cat(paste0('Mrp model predictions RMSE: ', format(rmse_mrp, digits = 4)))
cat(paste0('Baseline model predictions RMSE: ', format(rmse_baseline, digits = 4)))
cat(paste0('Ensemble model predictions RMSE: ', format(rmse_ensemble, digits = 4)))
results_tbl <- data.frame(model = c('MRP','Baseline','Ensemble'),
R = c(cor_mrp, cor_baseline, cor_ensemble),
Missed_Races = c(miss_mrp, miss_baseline, miss_ensemble),
Predicted_GOP_Seats = c(diff_mrp, diff_baseline, diff_ensemble),
RMSE = c(rmse_mrp, rmse_baseline, rmse_ensemble)
) |> t()
# latex_tbl <- xtable(
#   results_tbl,
#   caption = "Model Performance on 2018 U.S. House Elections",
#   label = "tab:model_performance_2018",
#   align = c("l", "l", "c", "c", "c")
# )
#
# print(
#   latex_tbl,
#   file = "tables/model_performance_2018.tex",
#   include.rownames = FALSE,
#   caption.placement = "top"
# )
################################################################################
#Create posterior distribution plot of ensemble and mrp models
posterior_ensemble <- combined |>
select(state, district, year, r_d_victory_margin_baseline, matches('X', ignore.case = F)) |>
mutate(across(matches('X', ignore.case = F),
~ . * ENSEMBLE_WT_MRP + r_d_victory_margin_baseline * ENSEMBLE_WT_BASELINE))
data.frame(seat_count = apply(posterior_ensemble |> select(matches('X', ignore.case = F)),
MARGIN = 2, function(x) {sum(ifelse(x > 0, 1, 0))}) |>
as.vector()) |>
ggplot(aes(seat_count)) +
geom_histogram(binwidth = 1) +
labs(x = '', y = '', title = '')
theme_bw()
library(tidyverse)
library(ggplot2)
library(stringr)
library(xtable)
setwd('~/DropBox/house_model/')
ENSEMBLE_WT_MRP <- 0.33
ENSEMBLE_WT_BASELINE <- 0.67
#Read MIT Data Lab congressional election returns for 2018 to assess models
house <- read.csv('cleaned_data/1976-2024-house.tab') |>
select(-state) |>
rename('state' = 'state_po') |>
#filter(year == 2018) |>
mutate(district = as.integer(district)) |>
filter(party == 'DEMOCRAT' | party == 'REPUBLICAN') |>
mutate(rvote = case_when(
party == 'REPUBLICAN' ~ candidatevotes,
.default = 0
),
dvote = case_when(
party == 'DEMOCRAT' ~ candidatevotes,
.default = 0
)) |>
group_by(district, state, year) |>
summarize(dvoteshr = sum(dvote)/sum(dvote + rvote),
rvoteshr = sum(rvote)/sum(dvote + rvote)) |>
mutate(
r_d_victory_margin_mit = rvoteshr - dvoteshr
)
baseline_pred <- read.csv('cleaned_data/baseline_mod_predictions.csv') |>
mutate(r_d_victory_margin_baseline = r_d_victory_margin_pred/100)
#Check that mit victory margins agree with DDHQ's
x <- left_join(baseline_pred, house, by = c('state','year', 'district')) |>
select(r_d_victory_margin, r_d_victory_margin_mit, state, year, district)
plot(x$r_d_victory_margin, x$r_d_victory_margin_mit)
mrp <- read.csv('cleaned_data/mrp_margin_turnout_weight.csv') |>
mutate(r_d_victory_margin_mrp = mean) |>
mutate(district = case_when(
state %in% c('AK', 'DE', 'MT', 'ND', 'SD', 'VT', 'WY') ~ 0,
.default = district
))
combined <- baseline_pred |>
mutate(r_d_victory_margin = case_when(
year == 2018 ~ NA,
.default = r_d_victory_margin
)) |>
left_join(mrp |> select(state, district, year, r_d_victory_margin_mrp, matches('[^q][0-9]+')),
by = c('state', 'district', 'year')) |>
left_join(house |> select(state, district, year, r_d_victory_margin_mit),
by = c('state', 'district', 'year')) |>
mutate(r_d_victory_margin = case_when(
year == 2018 ~ r_d_victory_margin_mit,
.default = r_d_victory_margin
)) |>
mutate(r_d_victory_margin_ensemble =
as.double(r_d_victory_margin_mrp)*ENSEMBLE_WT_MRP +
as.double(r_d_victory_margin_baseline)*ENSEMBLE_WT_BASELINE) |>
select(state, district, year,
r_d_victory_margin,
r_d_victory_margin_baseline,
r_d_victory_margin_mrp,
r_d_victory_margin_ensemble,
matches('[0-9]+')
) |>
filter(year == 2018)
################################################################################
#Visualizations of model performance
#facet wrap?
ggplot(combined, aes(x = r_d_victory_margin_ensemble, y = r_d_victory_margin)) +
geom_point() +
labs(x = '', y = '', title = '') +
theme_bw()
cor_mrp <- cor(combined$r_d_victory_margin, combined$r_d_victory_margin_mrp, use = 'complete.obs')
cor_baseline <- cor(combined$r_d_victory_margin, combined$r_d_victory_margin_baseline, use = 'complete.obs')
cor_ensemble <- cor(combined$r_d_victory_margin, combined$r_d_victory_margin_ensemble, use = 'complete.obs')
cat(paste0('Corr of mrp model predictions and vote share: ', format(cor_mrp, digits = 4)))
cat(paste0('Corr of baseline model predictions and vote share: ', format(cor_baseline, digits = 4)))
cat(paste0('Corr of ensemble model predictions and vote share: ', format(cor_ensemble, digits = 4)))
miss_mrp <- sum(ifelse( (combined$r_d_victory_margin > 0 & combined$r_d_victory_margin_mrp <= 0) |
(combined$r_d_victory_margin <= 0 & combined$r_d_victory_margin_mrp > 0),
1, 0 ), na.rm = T)
miss_baseline <- sum(ifelse( (combined$r_d_victory_margin > 0 & combined$r_d_victory_margin_baseline <= 0) |
(combined$r_d_victory_margin <= 0 & combined$r_d_victory_margin_baseline > 0),
1, 0), na.rm = T)
miss_ensemble <- sum(ifelse( (combined$r_d_victory_margin > 0 & combined$r_d_victory_margin_ensemble <= 0) |
(combined$r_d_victory_margin <= 0 & combined$r_d_victory_margin_ensemble > 0),
1, 0), na.rm = T)
cat(paste0('Mrp model predictions missed races: ', format(miss_mrp, digits = 4)))
cat(paste0('Baseline model predictions missed races: ', format(miss_baseline, digits = 4)))
cat(paste0('Ensemble model predictions missed races: ', format(miss_ensemble, digits = 4)))
diff_mrp <- sum(ifelse( (combined$r_d_victory_margin_mrp >= 0), 1, 0 ), na.rm = T)
diff_baseline <- sum(ifelse( (combined$r_d_victory_margin_baseline >= 0), 1, 0 ), na.rm = T)
diff_ensemble <- sum(ifelse( (combined$r_d_victory_margin_ensemble >= 0), 1, 0 ), na.rm = T)
cat(paste0('Mrp model predicted GOP seats: ', format(diff_mrp, digits = 4)))
cat(paste0('Baseline model predicted GOP seats: ', format(diff_baseline, digits = 4)))
cat(paste0('Ensemble model predicted GOP seats: ', format(diff_ensemble, digits = 4)))
rmse_mrp <- mean((combined$r_d_victory_margin - combined$r_d_victory_margin_mrp)^2, na.rm = T)^0.5
rmse_baseline <- mean((combined$r_d_victory_margin - combined$r_d_victory_margin_baseline)^2, na.rm = T)^0.5
rmse_ensemble <- mean((combined$r_d_victory_margin - combined$r_d_victory_margin_ensemble)^2, na.rm = T)^0.5
cat(paste0('Mrp model predictions RMSE: ', format(rmse_mrp, digits = 4)))
cat(paste0('Baseline model predictions RMSE: ', format(rmse_baseline, digits = 4)))
cat(paste0('Ensemble model predictions RMSE: ', format(rmse_ensemble, digits = 4)))
results_tbl <- data.frame(model = c('MRP','Baseline','Ensemble'),
R = c(cor_mrp, cor_baseline, cor_ensemble),
Missed_Races = c(miss_mrp, miss_baseline, miss_ensemble),
Predicted_GOP_Seats = c(diff_mrp, diff_baseline, diff_ensemble),
RMSE = c(rmse_mrp, rmse_baseline, rmse_ensemble)
) |> t()
# latex_tbl <- xtable(
#   results_tbl,
#   caption = "Model Performance on 2018 U.S. House Elections",
#   label = "tab:model_performance_2018",
#   align = c("l", "l", "c", "c", "c")
# )
#
# print(
#   latex_tbl,
#   file = "tables/model_performance_2018.tex",
#   include.rownames = FALSE,
#   caption.placement = "top"
# )
################################################################################
#Create posterior distribution plot of ensemble and mrp models
posterior_ensemble <- combined |>
select(state, district, year, r_d_victory_margin_baseline, matches('X', ignore.case = F)) |>
mutate(across(matches('X', ignore.case = F),
~ . * ENSEMBLE_WT_MRP + r_d_victory_margin_baseline * ENSEMBLE_WT_BASELINE))
data.frame(seat_count = apply(posterior_ensemble |> select(matches('X', ignore.case = F)),
MARGIN = 2, function(x) {sum(ifelse(x > 0, 1, 0))}) |>
as.vector()) |>
ggplot(aes(seat_count)) +
geom_histogram(binwidth = 1) +
labs(x = '', y = '', title = '')
theme_bw()
library(tidyverse)
library(mice)
library(brms)
################################################################################
#Fit Baseline Multiple Linear Regression Model
setwd('~/DropBox/house_model/')
#Note: seed the imputation of missing data in the geography column
set.seed(1234)
ddhq_data <- read.csv('cleaned_data/ddhq_data.csv')
#Rename variables to snake case
names(ddhq_data) <- gsub('[.]', '_', tolower(names(ddhq_data)))
#Dataset containing self-tabulated features: Gallup presidential approval from
#the last survey fielded in October, BLS Q3 inflation and GDP growth rates,
#incumbent party, and midterm versus general election indicator variables
fundamentals <- read.csv('cleaned_data/fundamentals.csv') |>
mutate(
mean_approve = mean(gallup_pres_oct_approve),
mean_inflation = mean(inflation_q3),
mean_gdp = mean(gdp_q3),
#Multiplying by the incumbent party will cause clustering, so we center predictor before multiplying
gallup_pres_oct_approve_times_inc = inc_party*(gallup_pres_oct_approve - mean_approve),
midterm_times_inc = inc_party*midterm,
inflation_q3_times_inc = inc_party*(inflation_q3 - mean_inflation),
gdp_q3_times_inc = inc_party*(gdp_q3 - mean_gdp) ) |>
select(-mean_approve, -mean_inflation, -mean_gdp)
ddhq_data <- ddhq_data |> left_join(fundamentals, by = 'year')
ddhq_data <- ddhq_data |>
mutate(r_d_victory_margin = as.double(r_d_victory_margin), #NOTE: converts '???' to NA, generates warning message
congressional_district = factor(congressional_district))
#Imputation Strategy
#Set geography of districts in WY (62% Urban), MT (53%), SD (57%), ND (61%), AK (65%)
#Source: 2020 Census
#In the remaining missing cases, perform polytomous imputation of ordered factor using pop sq mile variable
ddhq_data <- ddhq_data |>
mutate(geography = case_when(
#NOTE: make sure to impute for all missing cases, or there will be duplicate imputations
#Program shares imputation between unique combinations of density and district. If
#an imputation already exists, the row will be duplicated
is.na(geography) & state == 'WY' ~ 'Quite Rural',
is.na(geography) & state == 'SD' ~ 'Quite Rural',
is.na(geography) & state == 'MT' ~ 'Quite Rural',
is.na(geography) & state == 'ND' ~ 'Quite Rural',
is.na(geography) & state == 'AK' ~ 'Quite Rural',
.default = geography
))
ddhq_data$geography <- ordered(ddhq_data$geography,
levels = c('Extremely Rural',
'Quite Rural',
'Quite Urban',
'Extremely Urban'),
labels = c('Extremely Rural',
'Quite Rural',
'Quite Urban',
'Extremely Urban'))
#Impute geography using polytomous regression of geography on population_square_mile
#First, create id for each unique combination of congressional district and population density
ddhq_data <- ddhq_data |>
group_by(population_square_mile, congressional_district, state) |>
mutate(geography_id = cur_group_id()) |>
ungroup()
unique_geography <- ddhq_data |> distinct(
geography,
population_square_mile,
congressional_district,
state,
geography_id)
imputed <- mice.impute.polr(unique_geography$geography,
!is.na(unique_geography$geography),
unique_geography |> select(population_square_mile),
is.na(unique_geography$geography),
nnet.maxit = 100,
nnet.trace = FALSE,
nnet.MaxNWts = 1500,
polr.to.loggedEvents = T)
unique_geography[which(is.na(unique_geography$geography)), 'geography_impute'] <- imputed
ddhq_data <- ddhq_data |>
left_join(unique_geography |> select(geography_impute, geography_id),
by = 'geography_id') |>
mutate(geography = coalesce(geography, geography_impute)) |>
select(-geography_id, -geography_impute)
#Drop uncontested races, will combine predictions later
ddhq_filter <- ddhq_data |>
filter(`unopposed_r_` == 0 & `unopposed_d_` == 0) |>
#select(-`unopposed_r_`, -`unopposed_d_`, -`chamber`) |>
select(-`chamber`) |>
select(-gallup_pres_oct_disapprove, -gallup_pres_oct_unsure) |>
rename('unopposed_r' = 'unopposed_r_',
'unopposed_d' = 'unopposed_d_',
'incumbent_running' = 'incumbent_running_')
ddhq_filter <- ddhq_filter |>
select(r_d_victory_margin, all_of(names(ddhq_filter)))
#ddhq_data |> select('congressional_district', 'state', 'year', 'geography_impute', 'geography', 'population_square_mile') |> View()
###################
#Fit baseline model
baseline_mod <- lm(r_d_victory_margin ~ . #add all predictors
-year
-congressional_district +  #exclude congressional district due to factor issue
gallup_pres_oct_approve_times_inc + #add interactions for inc_party and structural factors
midterm_times_inc +
gdp_q3_times_inc +
inflation_q3_times_inc
-gallup_pres_oct_approve #we predict republican vote margin,
-midterm                 #so we need to multiply fundamentals in direction of incumbency
-inc_party
-inflation_q3
-gdp_q3 ,
data = ddhq_filter |>
filter(year < 2018) |>
select(-race_id))
#
# baseline_bayes_mod <- brm(formula =
#     r_d_victory_margin ~ .
#     - year
#     - congressional_district
#     - race_id
#     - gallup_pres_oct_approve
#     - midterm
#     - inc_party
#     - inflation_q3
#     - gdp_q3,
#   family = gaussian(),
#   data = ddhq_filter |>
#     filter(year < 2018) |>
#     select(-race_id),
#   prior = c(prior(normal(0, 5), class = "b"),
#     prior(normal(0, 10), class = "Intercept"),
#     prior(student_t(3, 0, 5), class = "sigma")),
#   chains  = 1,
#   iter    = 2000,
#   warmup = 1000,
#   seed = 1234
# )
saveRDS(baseline_mod, '~/DropBox/house_model/models/baseline_model.rds')
ddhq_filter[which(ddhq_filter$year == 2018), 'r_d_victory_margin_pred'] <- predict(baseline_mod,
newdata = ddhq_filter |>
filter(year == 2018) |>
select(-race_id))
#Add uncontested races
ddhq_data <- ddhq_data |>
left_join(ddhq_filter |> select(race_id, r_d_victory_margin_pred), by = 'race_id') |>
mutate(r_d_victory_margin_pred = case_when(
year == 2018 & unopposed_r_ == 1 ~ 100,
year == 2018 & unopposed_d_ == 1 ~ -100,
.default = r_d_victory_margin_pred
)) |>
mutate(r_d_victory_margin = coalesce(r_d_victory_margin, r_d_victory_margin_pred)) |>
rename('district' = 'congressional_district')
write.csv(ddhq_data, 'cleaned_data/baseline_mod_predictions.csv')
ddhq_data <- ddhq_data |>
select(-r_d_victory_margin_pred)
#Compare forecasted outcome to actual result of 235D-199R
ddhq_data |> filter(year == 2018) |> summarize(dem = sum(r_d_victory_margin <= 0),
gop = sum(r_d_victory_margin > 0))
summary(baseline_mod)
library(stargazer)
stargzer(summary(baseline_mod))
stargazer(summary(baseline_mod))
stargazer(baseline_mod)
?stargazer
baseline_mod <- readRDS('models/baseline_mod.rds')
baseline_mod <- readRDS('models/baseline_model.rds')
stargazer(baseline_mod, out = 'tables/baseline_model.tex')
